<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Define a store of tables with table-prep formulas: a table store — tbl_store • pointblank</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Define a store of tables with table-prep formulas: a table store — tbl_store"><meta name="description" content='It can be useful to set up all the data sources you need and just draw from
them when necessary. This upfront configuration with tbl_store() lets us
define the methods for obtaining tabular data from mixed sources (e.g.,
database tables, tables generated from flat files, etc.) and provide
identifiers for these data preparation procedures.
What results from this work is a convenient way to materialize tables with
tbl_get(). We can also get any table-prep formula from the table store
with tbl_source(). The content of a table-prep formulas can involve reading
a table from a location, or, it can involve data transformation. One can
imagine scenarios where we might (1) procure several mutated variations of
the same source table, (2) generate a table using disparate data sources, or
(3) filter the rows of a database table according to the system time. Another
nice aspect of organizing table-prep formulas in a single object is supplying
it to the tbl argument of create_agent() or create_informant() via $
notation (e.g, create_agent(tbl = &amp;lt;tbl_store&amp;gt;$&amp;lt;name&amp;gt;)) or with
tbl_source() (e.g.,
create_agent(tbl = ~ tbl_source("&amp;lt;name&amp;gt;", &amp;lt;tbl_store&amp;gt;))).'><meta property="og:description" content='It can be useful to set up all the data sources you need and just draw from
them when necessary. This upfront configuration with tbl_store() lets us
define the methods for obtaining tabular data from mixed sources (e.g.,
database tables, tables generated from flat files, etc.) and provide
identifiers for these data preparation procedures.
What results from this work is a convenient way to materialize tables with
tbl_get(). We can also get any table-prep formula from the table store
with tbl_source(). The content of a table-prep formulas can involve reading
a table from a location, or, it can involve data transformation. One can
imagine scenarios where we might (1) procure several mutated variations of
the same source table, (2) generate a table using disparate data sources, or
(3) filter the rows of a database table according to the system time. Another
nice aspect of organizing table-prep formulas in a single object is supplying
it to the tbl argument of create_agent() or create_informant() via $
notation (e.g, create_agent(tbl = &amp;lt;tbl_store&amp;gt;$&amp;lt;name&amp;gt;)) or with
tbl_source() (e.g.,
create_agent(tbl = ~ tbl_source("&amp;lt;name&amp;gt;", &amp;lt;tbl_store&amp;gt;))).'><meta property="og:image" content="https://rstudio.github.io/pointblank/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pointblank</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pointblank.html">Get Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Validation Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/validation_workflows.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-V.html">VALID-V: Table Scan</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Information Management</h6></li>
    <li><a class="dropdown-item" href="../articles/INFO-1.html">Intro to Information Management</a></li>
    <li><a class="dropdown-item" href="../articles/INFO-2.html">Advanced Information Management</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/pointblank/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Define a store of tables with table-prep formulas: a table store</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstudio/pointblank/blob/main/R/tbl_store.R" class="external-link"><code>R/tbl_store.R</code></a></small>
      <div class="d-none name"><code>tbl_store.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>It can be useful to set up all the data sources you need and just draw from
them when necessary. This upfront configuration with <code>tbl_store()</code> lets us
define the methods for obtaining tabular data from mixed sources (e.g.,
database tables, tables generated from flat files, etc.) and provide
identifiers for these data preparation procedures.</p>
<p>What results from this work is a convenient way to materialize tables with
<code><a href="tbl_get.html">tbl_get()</a></code>. We can also get any table-prep formula from the table store
with <code><a href="tbl_source.html">tbl_source()</a></code>. The content of a table-prep formulas can involve reading
a table from a location, or, it can involve data transformation. One can
imagine scenarios where we might (1) procure several mutated variations of
the same source table, (2) generate a table using disparate data sources, or
(3) filter the rows of a database table according to the system time. Another
nice aspect of organizing table-prep formulas in a single object is supplying
it to the <code>tbl</code> argument of <code><a href="create_agent.html">create_agent()</a></code> or <code><a href="create_informant.html">create_informant()</a></code> via <code>$</code>
notation (e.g, <code>create_agent(tbl = &lt;tbl_store&gt;$&lt;name&gt;)</code>) or with
<code><a href="tbl_source.html">tbl_source()</a></code> (e.g.,
<code>create_agent(tbl = ~ tbl_source("&lt;name&gt;", &lt;tbl_store&gt;))</code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tbl_store</span><span class="op">(</span><span class="va">...</span>, .list <span class="op">=</span> <span class="fu">list2</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>, .init <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Expressions that contain table-prep formulas and table names for
data retrieval. Two-sided formulas (e.g, <code>&lt;LHS&gt; ~ &lt;RHS&gt;</code>) are to be used,
where the left-hand side is an identifier and the right-hand contains a
statement that obtains a table (i.e., the table-prep formula). If the LHS
is omitted then an identifier will be generated for you.</p></dd>


<dt id="arg--list">.list<a class="anchor" aria-label="anchor" href="#arg--list"></a></dt>
<dd><p>Allows for the use of a list as an input alternative to <code>...</code>.</p></dd>


<dt id="arg--init">.init<a class="anchor" aria-label="anchor" href="#arg--init"></a></dt>
<dd><p>We can optionally provide an initialization statement (in a
one-sided formula) that should be executed whenever <em>any</em> of tables in the
table store are obtained. This is useful, for instance, for including a
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> call that can be executed before any table-prep formulas in
<code>...</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>tbl_store</code> object that contains table-prep formulas.</p>
    </div>
    <div class="section level2">
    <h2 id="yaml">YAML<a class="anchor" aria-label="anchor" href="#yaml"></a></h2>



<p>A <strong>pointblank</strong> table store can be written to YAML with <code><a href="yaml_write.html">yaml_write()</a></code> and
the resulting YAML can be used in several ways. The ideal scenario is to have
pointblank agents and informants also in YAML form. This way the agent and
informant can refer to the table store YAML (via <code><a href="tbl_source.html">tbl_source()</a></code>), and, the
processing of both agents and informants can be performed with
<code><a href="yaml_agent_interrogate.html">yaml_agent_interrogate()</a></code> and <code><a href="yaml_informant_incorporate.html">yaml_informant_incorporate()</a></code>. With the
following R code, a table store with two table-prep formulas is generated and
written to YAML (if no filename is given then the YAML is written to
<code>"tbl_store.yml"</code>).</p>
<p>R statement for generating the <code>"tbl_store.yml"</code> file:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_store.html">tbl_store</a></span><span class="op">(</span></span>
<span>  <span class="va">tbl_duckdb</span> <span class="op">~</span> <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span><span class="va">small_table</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span>, dbtype <span class="op">=</span> <span class="st">"duckdb"</span><span class="op">)</span>,</span>
<span>  <span class="va">sml_table_high</span> <span class="op">~</span> <span class="va">small_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span>,</span>
<span>  .init <span class="op">=</span> <span class="op">~</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/yaml_write.html">yaml_write</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p>YAML representation (<code>"tbl_store.yml"</code>):</p>
<p></p><div class="sourceCode yaml"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">type</span><span class="kw">:</span><span class="at"> tbl_store</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">tbls</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="at">  </span><span class="fu">tbl_duckdb</span><span class="kw">:</span><span class="at"> ~ db_tbl(small_table, dbname = ":memory:", dbtype = "duckdb")</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="at">  </span><span class="fu">sml_table_high</span><span class="kw">:</span><span class="at"> ~ small_table %&gt;% dplyr::filter(f == "high")</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">init</span><span class="kw">:</span><span class="at"> ~library(tidyverse)</span></span></code></pre><p></p></div>
<p>This is useful when you want to get fresh pulls of prepared data from a
source materialized in an R session (with the <code><a href="tbl_get.html">tbl_get()</a></code> function. For
example, the <code>sml_table_high</code> table can be obtained by using
<code>tbl_get("sml_table_high", "tbl_store.yml")</code>. To get an agent to check this
prepared data periodically, then the following example with <code><a href="tbl_source.html">tbl_source()</a></code>
will be useful:</p>
<p>R code to generate agent that checks <code>sml_table_high</code> and writing the agent
to YAML:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/create_agent.html">create_agent</a></span><span class="op">(</span></span>
<span>  tbl <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/tbl_source.html">tbl_source</a></span><span class="op">(</span><span class="st">"sml_table_high"</span>, <span class="st">"tbl_store.yml"</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"An example that uses a table store."</span>,</span>
<span>  actions <span class="op">=</span> <span class="fu"><a href="../reference/action_levels.html">action_levels</a></span><span class="op">(</span>warn_at <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/col_exists.html">col_exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">date_time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">write_yaml</span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The YAML representation (<code>"agent-sml_table_high.yml"</code>):</p>
<p></p><div class="sourceCode yaml"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">tbl</span><span class="kw">:</span><span class="at"> ~ tbl_source("sml_table_high", "tbl_store.yml")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">tbl_name</span><span class="kw">:</span><span class="at"> sml_table_high</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">label</span><span class="kw">:</span><span class="at"> An example that uses a table store.</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">actions</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="at">  </span><span class="fu">warn_fraction</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">locale</span><span class="kw">:</span><span class="at"> en</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">col_exists</span><span class="kw">:</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="at">    </span><span class="fu">columns</span><span class="kw">:</span><span class="at"> c(date, date_time)</span></span></code></pre><p></p></div>
<p>Now, whenever the <code>sml_table_high</code> table needs to be validated, it can be
done with <code><a href="yaml_agent_interrogate.html">yaml_agent_interrogate()</a></code> (e.g.,
<code>yaml_agent_interrogate("agent-sml_table_high.yml")</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>


<div class="section">
<h3 id="creating-an-in-memory-table-store-and-adding-table-prep-formulas">Creating an in-memory table store and adding table-prep formulas<a class="anchor" aria-label="anchor" href="#creating-an-in-memory-table-store-and-adding-table-prep-formulas"></a></h3>


<p>The table store provides a way to get the tables we need fairly easily. Think
of an identifier for the table you'd like and then provide the code necessary
to obtain that table. Then repeat as many times as you like!</p>
<p>Here we'll define two tables that can be materialized later: <code>tbl_duckdb</code> (an
in-memory DuckDB database table with <strong>pointblank</strong>'s <code>small_table</code> dataset)
and <code>sml_table_high</code> (a filtered version of <code>tbl_duckdb</code>):</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/tbl_store.html">tbl_store</a></span><span class="op">(</span></span>
<span>    <span class="va">tbl_duckdb</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>        <span class="fu">pointblank</span><span class="fu">::</span><span class="va"><a href="../reference/small_table.html">small_table</a></span>,</span>
<span>        dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>        dbtype <span class="op">=</span> <span class="st">"duckdb"</span></span>
<span>      <span class="op">)</span>,</span>
<span>    <span class="va">sml_table_high</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>        <span class="fu">pointblank</span><span class="fu">::</span><span class="va"><a href="../reference/small_table.html">small_table</a></span>,</span>
<span>        dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>        dbtype <span class="op">=</span> <span class="st">"duckdb"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
<p>We can see what's in the table store <code>store_1</code> by printing it out:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_1</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## -- The `table_store` table-prep formulas</span></span>
<span><span class="co">## 1 tbl_duckdb // ~ db_tbl(pointblank::small_table, dbname = ":memory:",</span></span>
<span><span class="co">## dbtype = "duckdb")</span></span>
<span><span class="co">## 2 sml_table_high // ~ db_tbl(pointblank::small_table, dbname = ":memory:",</span></span>
<span><span class="co">## dbtype = "duckdb") %&gt;% dplyr::filter(f == "high")</span></span>
<span><span class="co">## ----</span></span></code></pre></div>

<p>It's good to check that the tables can be obtained without error. We can do
this with the <code><a href="tbl_get.html">tbl_get()</a></code> function. With that function, we need to supply the
given name of the table-prep formula (in quotes) and the table store object.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span>tbl <span class="op">=</span> <span class="st">"tbl_duckdb"</span>, store <span class="op">=</span> <span class="va">store_1</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   table&lt;pointblank::small_table&gt; [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##    date_time           date           a b             c      d e     f</span></span>
<span><span class="co">##    &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">##  1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3  3423. TRUE  high</span></span>
<span><span class="co">##  2 2016-01-04 00:32:00 2016-01-04     3 5-egh-163     8 10000. TRUE  low</span></span>
<span><span class="co">##  3 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3  2343. TRUE  high</span></span>
<span><span class="co">##  4 2016-01-06 17:23:00 2016-01-06     2 5-jdo-903    NA  3892. FALSE mid</span></span>
<span><span class="co">##  5 2016-01-09 12:36:00 2016-01-09     8 3-ldm-038     7   284. TRUE  low</span></span>
<span><span class="co">##  6 2016-01-11 06:15:00 2016-01-11     4 2-dhe-923     4  3291. TRUE  mid</span></span>
<span><span class="co">##  7 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3   843. TRUE  high</span></span>
<span><span class="co">##  8 2016-01-17 11:27:00 2016-01-17     4 5-boe-639     2  1036. FALSE low</span></span>
<span><span class="co">##  9 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## 10 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## # … with more rows</span></span></code></pre></div>



<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span>tbl <span class="op">=</span> <span class="st">"sml_table_high"</span>, store <span class="op">=</span> <span class="va">store_1</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   lazy query [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##   date_time           date           a b             c     d e     f</span></span>
<span><span class="co">##   &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">## 1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3 3423. TRUE  high</span></span>
<span><span class="co">## 2 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3 2343. TRUE  high</span></span>
<span><span class="co">## 3 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3  843. TRUE  high</span></span>
<span><span class="co">## 4 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9  838. FALSE high</span></span>
<span><span class="co">## 5 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9  838. FALSE high</span></span>
<span><span class="co">## 6 2016-01-30 11:23:00 2016-01-30     1 3-dka-303    NA 2230. TRUE  high</span></span></code></pre></div>

<p>We can shorten the <code>tbl_store()</code> statement with some syntax that
<strong>pointblank</strong> provides. The <code>sml_table_high</code> table-prep is simply a
transformation of <code>tbl_duckdb</code>, so, we can use <code>{{ tbl_duckdb }}</code> in place of
the repeated statement. Additionally, we can provide a <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> call to
the <code>.init</code> argument of <code>tbl_store()</code> so that <strong>dplyr</strong> is available (thus
allowing us to use <code>filter(...)</code> instead of <code>dplyr::filter(...)</code>). Here is
the revised <code>tbl_store()</code> call:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/tbl_store.html">tbl_store</a></span><span class="op">(</span></span>
<span>    <span class="va">tbl_duckdb</span> <span class="op">~</span></span>
<span>      <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>        <span class="fu">pointblank</span><span class="fu">::</span><span class="va"><a href="../reference/small_table.html">small_table</a></span>,</span>
<span>        dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>        dbtype <span class="op">=</span> <span class="st">"duckdb"</span></span>
<span>      <span class="op">)</span>,</span>
<span>    <span class="va">sml_table_high</span> <span class="op">~</span></span>
<span>      <span class="op">{</span><span class="op">{</span> <span class="va">tbl_duckdb</span> <span class="op">}</span><span class="op">}</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">f</span> <span class="op">==</span> <span class="st">"high"</span><span class="op">)</span>,</span>
<span>    .init <span class="op">=</span> <span class="op">~</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
<p>Printing the table store <code>store_2</code> now shows that we used an <code>.init</code>
statement:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_2</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## -- The `table_store` table-prep formulas</span></span>
<span><span class="co">## 1 tbl_duckdb // ~ db_tbl(pointblank::small_table, dbname = ":memory:",</span></span>
<span><span class="co">## dbtype = "duckdb")</span></span>
<span><span class="co">## 2 sml_table_high // ~ {{tbl_duckdb}} %&gt;% filter(f == "high")</span></span>
<span><span class="co">## ----</span></span>
<span><span class="co">## INIT // ~library(tidyverse)</span></span>
<span><span class="co">## ----</span></span></code></pre></div>

<p>Checking again with <code><a href="tbl_get.html">tbl_get()</a></code> should provide the same tables as before:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span>tbl <span class="op">=</span> <span class="st">"tbl_duckdb"</span>, store <span class="op">=</span> <span class="va">store_2</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   table&lt;pointblank::small_table&gt; [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##    date_time           date           a b             c      d e     f</span></span>
<span><span class="co">##    &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">##  1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3  3423. TRUE  high</span></span>
<span><span class="co">##  2 2016-01-04 00:32:00 2016-01-04     3 5-egh-163     8 10000. TRUE  low</span></span>
<span><span class="co">##  3 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3  2343. TRUE  high</span></span>
<span><span class="co">##  4 2016-01-06 17:23:00 2016-01-06     2 5-jdo-903    NA  3892. FALSE mid</span></span>
<span><span class="co">##  5 2016-01-09 12:36:00 2016-01-09     8 3-ldm-038     7   284. TRUE  low</span></span>
<span><span class="co">##  6 2016-01-11 06:15:00 2016-01-11     4 2-dhe-923     4  3291. TRUE  mid</span></span>
<span><span class="co">##  7 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3   843. TRUE  high</span></span>
<span><span class="co">##  8 2016-01-17 11:27:00 2016-01-17     4 5-boe-639     2  1036. FALSE low</span></span>
<span><span class="co">##  9 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## 10 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## # … with more rows</span></span></code></pre></div>



<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span>tbl <span class="op">=</span> <span class="st">"sml_table_high"</span>, store <span class="op">=</span> <span class="va">store_2</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   lazy query [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##   date_time           date           a b             c     d e     f</span></span>
<span><span class="co">##   &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">## 1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3 3423. TRUE  high</span></span>
<span><span class="co">## 2 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3 2343. TRUE  high</span></span>
<span><span class="co">## 3 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3  843. TRUE  high</span></span>
<span><span class="co">## 4 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9  838. FALSE high</span></span>
<span><span class="co">## 5 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9  838. FALSE high</span></span>
<span><span class="co">## 6 2016-01-30 11:23:00 2016-01-30     1 3-dka-303    NA 2230. TRUE  high</span></span></code></pre></div>

</div>

<div class="section">
<h3 id="using-a-table-store-in-a-data-validation-workflow">Using a table store in a data validation workflow<a class="anchor" aria-label="anchor" href="#using-a-table-store-in-a-data-validation-workflow"></a></h3>


<p>Define a <code>tbl_store</code> object by adding table-prep formulas inside the
<code>tbl_store()</code> call.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/tbl_store.html">tbl_store</a></span><span class="op">(</span></span>
<span>    <span class="va">small_table_duck</span> <span class="op">~</span> <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>      table <span class="op">=</span> <span class="va">small_table</span>,</span>
<span>      dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>      dbtype <span class="op">=</span> <span class="st">"duckdb"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="op">~</span> <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>      table <span class="op">=</span> <span class="st">"rna"</span>,</span>
<span>      dbname <span class="op">=</span> <span class="st">"pfmegrnargs"</span>,</span>
<span>      dbtype <span class="op">=</span> <span class="st">"postgres"</span>,</span>
<span>      host <span class="op">=</span> <span class="st">"hh-pgsql-public.ebi.ac.uk"</span>,</span>
<span>      port <span class="op">=</span> <span class="fl">5432</span>,</span>
<span>      user <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="st">"reader"</span><span class="op">)</span>,</span>
<span>      password <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="st">"NWDMCE5xdipIjRrp"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">all_revenue</span> <span class="op">~</span> <span class="fu"><a href="../reference/db_tbl.html">db_tbl</a></span><span class="op">(</span></span>
<span>      table <span class="op">=</span> <span class="fu"><a href="../reference/file_tbl.html">file_tbl</a></span><span class="op">(</span></span>
<span>        file <span class="op">=</span> <span class="fu"><a href="../reference/from_github.html">from_github</a></span><span class="op">(</span></span>
<span>          file <span class="op">=</span> <span class="st">"sj_all_revenue_large.rds"</span>,</span>
<span>          repo <span class="op">=</span> <span class="st">"rich-iannone/intendo"</span>,</span>
<span>          subdir <span class="op">=</span> <span class="st">"data-large"</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      dbname <span class="op">=</span> <span class="st">":memory:"</span>,</span>
<span>      dbtype <span class="op">=</span> <span class="st">"duckdb"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="va">sml_table</span> <span class="op">~</span> <span class="fu">pointblank</span><span class="fu">::</span><span class="va"><a href="../reference/small_table.html">small_table</a></span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
<p>Let's get a summary of what's in the table store <code>store_3</code> through printing:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_3</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## -- The `table_store` table-prep formulas</span></span>
<span><span class="co">## 1 small_table_duck // ~ db_tbl(table = small_table, dbname = ":memory:",</span></span>
<span><span class="co">## dbtype = "duckdb")</span></span>
<span><span class="co">## 2 rna // ~db_tbl(table = "rna", dbname = "pfmegrnargs", dbtype =</span></span>
<span><span class="co">## "postgres", host = "hh-pgsql-public.ebi.ac.uk", port = 5432, user =</span></span>
<span><span class="co">## I("reader"), password = I("NWDMCE5xdipIjRrp"))</span></span>
<span><span class="co">## 3 all_revenue // ~ db_tbl(table = file_tbl(file = from_github(file =</span></span>
<span><span class="co">## "sj_all_revenue_large.rds", repo = "rich-iannone/intendo", subdir =</span></span>
<span><span class="co">## "data-large")), dbname = ":memory:", dbtype = "duckdb")</span></span>
<span><span class="co">## 4 sml_table // ~ pointblank::small_table</span></span>
<span><span class="co">## ----</span></span></code></pre></div>

<p>Once this object is available, you can check that the table of interest is
produced to your specification with the <code><a href="tbl_get.html">tbl_get()</a></code> function.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span></span>
<span>  tbl <span class="op">=</span> <span class="st">"small_table_duck"</span>,</span>
<span>  store <span class="op">=</span> <span class="va">store_3</span></span>
<span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   table&lt;small_table&gt; [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##    date_time           date           a b             c      d e     f</span></span>
<span><span class="co">##    &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">##  1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3  3423. TRUE  high</span></span>
<span><span class="co">##  2 2016-01-04 00:32:00 2016-01-04     3 5-egh-163     8 10000. TRUE  low</span></span>
<span><span class="co">##  3 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3  2343. TRUE  high</span></span>
<span><span class="co">##  4 2016-01-06 17:23:00 2016-01-06     2 5-jdo-903    NA  3892. FALSE mid</span></span>
<span><span class="co">##  5 2016-01-09 12:36:00 2016-01-09     8 3-ldm-038     7   284. TRUE  low</span></span>
<span><span class="co">##  6 2016-01-11 06:15:00 2016-01-11     4 2-dhe-923     4  3291. TRUE  mid</span></span>
<span><span class="co">##  7 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3   843. TRUE  high</span></span>
<span><span class="co">##  8 2016-01-17 11:27:00 2016-01-17     4 5-boe-639     2  1036. FALSE low</span></span>
<span><span class="co">##  9 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## 10 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## # … with more rows</span></span></code></pre></div>


<p>Another way to get the same table materialized is by using <code>$</code> to get the
entry of choice for <code><a href="tbl_get.html">tbl_get()</a></code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">store_3</span><span class="op">$</span><span class="va">small_table_duck</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/tbl_get.html">tbl_get</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<div class="sourceCode"><pre><code><span><span class="co">## # Source:   table&lt;small_table&gt; [?? x 8]</span></span>
<span><span class="co">## # Database: duckdb_connection</span></span>
<span><span class="co">##    date_time           date           a b             c      d e     f</span></span>
<span><span class="co">##    &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;</span></span>
<span><span class="co">##  1 2016-01-04 11:00:00 2016-01-04     2 1-bcd-345     3  3423. TRUE  high</span></span>
<span><span class="co">##  2 2016-01-04 00:32:00 2016-01-04     3 5-egh-163     8 10000. TRUE  low</span></span>
<span><span class="co">##  3 2016-01-05 13:32:00 2016-01-05     6 8-kdg-938     3  2343. TRUE  high</span></span>
<span><span class="co">##  4 2016-01-06 17:23:00 2016-01-06     2 5-jdo-903    NA  3892. FALSE mid</span></span>
<span><span class="co">##  5 2016-01-09 12:36:00 2016-01-09     8 3-ldm-038     7   284. TRUE  low</span></span>
<span><span class="co">##  6 2016-01-11 06:15:00 2016-01-11     4 2-dhe-923     4  3291. TRUE  mid</span></span>
<span><span class="co">##  7 2016-01-15 18:46:00 2016-01-15     7 1-knw-093     3   843. TRUE  high</span></span>
<span><span class="co">##  8 2016-01-17 11:27:00 2016-01-17     4 5-boe-639     2  1036. FALSE low</span></span>
<span><span class="co">##  9 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## 10 2016-01-20 04:30:00 2016-01-20     3 5-bce-642     9   838. FALSE high</span></span>
<span><span class="co">## # … with more rows</span></span></code></pre></div>


<p>Creating an agent is easy when all table-prep formulas are encapsulated in a
<code>tbl_store</code> object. Use <code>$</code> notation to pass the appropriate procedure for
reading a table to the <code>tbl</code> argument.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">agent_1</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/create_agent.html">create_agent</a></span><span class="op">(</span></span>
<span>    tbl <span class="op">=</span> <span class="va">store_3</span><span class="op">$</span><span class="va">small_table_duck</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
<p>There are other ways to use the table store to assign a target table to an
agent, like using the <code><a href="tbl_source.html">tbl_source()</a></code> function (which extracts the table-prep
formula from the table store).</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">agent_2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/create_agent.html">create_agent</a></span><span class="op">(</span></span>
<span>    tbl <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/tbl_source.html">tbl_source</a></span><span class="op">(</span></span>
<span>      tbl <span class="op">=</span> <span class="st">"small_table_duck"</span>,</span>
<span>      store <span class="op">=</span> <span class="va">store_3</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="writing-a-table-store-to-a-yaml-file">Writing a table store to a YAML file<a class="anchor" aria-label="anchor" href="#writing-a-table-store-to-a-yaml-file"></a></h3>


<p>The table store can be moved to YAML with <code>yaml_write</code> and the <code><a href="tbl_source.html">tbl_source()</a></code>
call could then refer to that on-disk table store. Let's do that YAML
conversion.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="../reference/yaml_write.html">yaml_write</a></span><span class="op">(</span><span class="va">store_3</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The above writes the <code>tbl_store.yml</code> file (by not providing a <code>filename</code> this
default filename is chosen).</p>
<p>It can be convenient to read table-prep formulas from a YAML file that's a
table store. To achieve this, we can modify the <code><a href="tbl_source.html">tbl_source()</a></code> statement in
the <code><a href="create_agent.html">create_agent()</a></code> call so that <code>store</code> refers to the on-disk YAML file.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">agent_3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/create_agent.html">create_agent</a></span><span class="op">(</span></span>
<span>    tbl <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/tbl_source.html">tbl_source</a></span><span class="op">(</span></span>
<span>      tbl <span class="op">=</span> <span class="st">"small_table_duck"</span>,</span>
<span>      store <span class="op">=</span> <span class="st">"tbl_store.yml"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="function-id">Function ID<a class="anchor" aria-label="anchor" href="#function-id"></a></h2>


<p>1-8</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other Planning and Prep:
<code><a href="action_levels.html">action_levels</a>()</code>,
<code><a href="create_agent.html">create_agent</a>()</code>,
<code><a href="create_informant.html">create_informant</a>()</code>,
<code><a href="db_tbl.html">db_tbl</a>()</code>,
<code><a href="draft_validation.html">draft_validation</a>()</code>,
<code><a href="file_tbl.html">file_tbl</a>()</code>,
<code><a href="scan_data.html">scan_data</a>()</code>,
<code><a href="tbl_get.html">tbl_get</a>()</code>,
<code><a href="tbl_source.html">tbl_source</a>()</code>,
<code><a href="validate_rmd.html">validate_rmd</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Iannone, Mauricio Vargas, June Choe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

