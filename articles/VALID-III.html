<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="pointblank">
<title>Introduction to the Expectations in Unit Tests Workflow (VALID-III) • pointblank</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the Expectations in Unit Tests Workflow (VALID-III)">
<meta property="og:description" content="pointblank">
<meta property="og:image" content="https://rich-iannone.github.io/pointblank/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pointblank</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Validation Workflows</h6>
    <a class="dropdown-item" href="../articles/validation_workflows.html">Overview</a>
    <a class="dropdown-item" href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a>
    <a class="dropdown-item" href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a>
    <a class="dropdown-item" href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a>
    <a class="dropdown-item" href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a>
    <a class="dropdown-item" href="../articles/VALID-V.html">VALID-V: Table Scan</a>
    <a class="dropdown-item" href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a>
    <h6 class="dropdown-header" data-toc-skip>Information Management</h6>
    <a class="dropdown-item" href="../articles/INFO-1.html">Intro to Information Management</a>
    <a class="dropdown-item" href="../articles/INFO-2.html">Advanced Information Management</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rich-iannone/pointblank/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="VALID-III_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Introduction to the Expectations in Unit Tests Workflow (VALID-III)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rich-iannone/pointblank/blob/HEAD/vignettes/VALID-III.Rmd" class="external-link"><code>vignettes/VALID-III.Rmd</code></a></small>
      <div class="d-none name"><code>VALID-III.Rmd</code></div>
    </div>

    
    
<p><img src="images/VALID-III.svg" width="100%"></p>
<p>The <em>VALID-III: Expectations in Unit Tests</em> workflow is all about checking your data alongside your usual <strong>testthat</strong> tests. The functions used for this workflow all begin with the <code>expect_</code> prefix and are based on the set of validation functions used in the <a href="../articles/VALID-I.html"><strong>VALID-I</strong></a> and <a href="../articles/VALID-II.html"><strong>VALID-II</strong></a> workflows. Here’s the complete list of functions with a phrase for each function’s expectation:</p>
<ul>
<li>
<code><a href="../reference/col_vals_lt.html">expect_col_vals_lt()</a></code>: Expect that column data are less than a specified value.</li>
<li>
<code><a href="../reference/col_vals_lte.html">expect_col_vals_lte()</a></code>: Expect that column data are less than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_equal.html">expect_col_vals_equal()</a></code>: Expect that column data are equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_not_equal.html">expect_col_vals_not_equal()</a></code>: Expect that column data are not equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gte.html">expect_col_vals_gte()</a></code>: Expect that column data are greater than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gt.html">expect_col_vals_gt()</a></code>: Expect that column data are greater than a specified value.</li>
<li>
<code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code>: Expect that column data are between two specified values.</li>
<li>
<code><a href="../reference/col_vals_not_between.html">expect_col_vals_not_between()</a></code>: Expect that column data are not between two specified values.</li>
<li>
<code><a href="../reference/col_vals_in_set.html">expect_col_vals_in_set()</a></code>: Expect that column data are part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_not_in_set.html">expect_col_vals_not_in_set()</a></code>: Expect that column data are not part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_null.html">expect_col_vals_null()</a></code>: Expect that column data are <code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_not_null.html">expect_col_vals_not_null()</a></code>: Expect that column data are not <code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_regex.html">expect_col_vals_regex()</a></code>: Expect that strings in column data match a regex pattern.</li>
<li>
<code><a href="../reference/col_vals_expr.html">expect_col_vals_expr()</a></code>: Expect that column data agree with a predicate expression.</li>
<li>
<code><a href="../reference/conjointly.html">expect_conjointly()</a></code>: Expect that multiple rowwise validations result in joint validity.</li>
<li>
<code><a href="../reference/rows_distinct.html">expect_rows_distinct()</a></code>: Expect that row data are distinct.</li>
<li>
<code><a href="../reference/col_is_character.html">expect_col_is_character()</a></code>: Expect that the columns contain character/string data.</li>
<li>
<code><a href="../reference/col_is_numeric.html">expect_col_is_numeric()</a></code>: Expect that the columns contain numeric values.</li>
<li>
<code><a href="../reference/col_is_integer.html">expect_col_is_integer()</a></code>: Expect that the columns contain integer values.</li>
<li>
<code><a href="../reference/col_is_logical.html">expect_col_is_logical()</a></code>: Expect that the columns contain logical values.</li>
<li>
<code><a href="../reference/col_is_date.html">expect_col_is_date()</a></code>: Expect that the columns contain R <code>Date</code> objects.</li>
<li>
<code><a href="../reference/col_is_posix.html">expect_col_is_posix()</a></code>: Expect that the columns contain <code>POSIXct</code> dates.</li>
<li>
<code><a href="../reference/col_is_factor.html">expect_col_is_factor()</a></code>: Expect that the columns contain R <code>factor</code> objects.</li>
<li>
<code><a href="../reference/col_exists.html">expect_col_exists()</a></code>: Expect that one or more columns actually exist.</li>
<li>
<code><a href="../reference/col_schema_match.html">expect_col_schema_match()</a></code>: Expect that columns in the table (and their types) match a predefined schema.</li>
</ul>
<p>Now that we know that the functions are similar in intent but different in name, let’s learn how to use these functions effectively.</p>
<div class="section level2">
<h2 id="using-expect_-functions-in-the-testthat-way">Using <code>expect_*()</code> Functions in the <strong>testthat</strong> Way<a class="anchor" aria-label="anchor" href="#using-expect_-functions-in-the-testthat-way"></a>
</h2>
<p>The <strong>testthat</strong> package has collection of functions that begin with <code>expect_</code>. It’s no coincidence that the <strong>pointblank</strong> for the <strong>VALID-III</strong> workflow adopts the same naming convention. The idea is to use these functions interchangeably with those from <strong>testthat</strong> in the standard <strong>testthat</strong> workflow (in a <code>test-&lt;name&gt;.R</code> file, inside the <code>tests/testthat</code> folder). The big difference here is that instead of testing function outputs, we are testing data tables. However, tables may be returned from function calls and the <code>expect_*()</code> functions offered up by <strong>pointblank</strong> might offer more flexibility for testing that data. For instance <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> allows us to write an expectation with fine control on boundary values (and whether they are inclusive bounds), whether <code>NA</code> values should be ignored, and we can even set a failure threshold if that makes sense for the expectation.</p>
<p>Here’s an example of how to generate some tests on data with <strong>testthat</strong> and also with <strong>pointblank</strong>. For the <code>small_table</code> dataset, let’s write expectations that show that non-NA values in column <code>c</code> are between <code>2</code> and <code>9</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>There is no <strong>testthat</strong> function that tests for values between two values. The original strategy was to use <code><a href="https://testthat.r-lib.org/reference/comparison-expectations.html" class="external-link">testthat::expect_gte()</a></code> and <code>testthat::lte()</code> with <code>small_table$c</code> as the <code>object</code> in both, however, that doesn’t work because that results in a logical vector greater than length 1. Also, there is no allowance for <code>NA</code> values to be skipped. The best I could do was the above.</p>
<p>The <strong>pointblank</strong> version of this task makes for a more succinct and understandable expectation expression:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/col_vals_between.html">expect_col_vals_between</a></span><span class="op">(</span><span class="va">small_table</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">9</span>, na_pass <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The arguments in the <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> give us everything we need to check tabular data without having to do subsetting and perform other transformations. There are a few added benefits. Should data come from a data source other than a local data frame, the SQL expressions are handled internally and they have been tested extensively across all the supported database types and in Spark DataFrames as well.</p>
</div>
<div class="section level2">
<h2 id="these-expect_-functions-are-simpler-than-their-counterparts">These <code>expect_*()</code> Functions Are Simpler Than Their Counterparts<a class="anchor" aria-label="anchor" href="#these-expect_-functions-are-simpler-than-their-counterparts"></a>
</h2>
<p>All of the <code>expect_*()</code> functions have the same leading arguments of their validation function counterparts but they omit the following arguments at the end of their signatures:</p>
<ul>
<li><code>actions</code></li>
<li><code>step_id</code></li>
<li><code>label</code></li>
<li><code>brief</code></li>
<li><code>active</code></li>
</ul>
<p>While we lose the <code>actions</code> argument, we get in its place the <code>threshold</code> argument. This is a simple failure threshold value for use with the expectation (<code>expect_*</code>) and the test (<code>test_*</code>) functions. By default, <code>threshold</code> is set to <code>1</code> which means that any single test unit failing will result in an overall failure (i.e., the expectation will fail).</p>
<p>As with the thresholds set in the <code><a href="../reference/action_levels.html">action_levels()</a></code> functions (or the shortcut functions <code><a href="../reference/action_levels.html">warn_on_fail()</a></code> and <code><a href="../reference/action_levels.html">stop_on_fail()</a></code>), whole numbers beyond <code>1</code> indicate that any failing units up to that absolute threshold value will result in a succeeding expectation. Likewise, fractional values (between <code>0</code> and <code>1</code>) act as a proportional failure threshold, where <code>0.25</code> means that 25% of failing test units results in a failed expectation.</p>
<p>The <code>preconditions</code> argument can be used to transform the input data before evaluation of the expectation. This is useful is some cases where you might need to summarize the input data table, mutate columns, perform some filtering, or even perform table joins beforehand.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Richard Iannone, Mauricio Vargas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
