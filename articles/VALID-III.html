<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to the Expectations in Unit Tests Workflow (VALID-III) • pointblank</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to the Expectations in Unit Tests Workflow (VALID-III)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pointblank</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.12.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/pointblank.html">Get Started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Validation Workflows</h6></li>
    <li><a class="dropdown-item" href="../articles/validation_workflows.html">Overview</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-I.html">VALID-I: Data Quality Reporting</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-II.html">VALID-II: Pipeline Data Validation</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-III.html">VALID-III: Expectations in Unit Tests</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-IV.html">VALID-IV: Data Tests for Conditionals</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-V.html">VALID-V: Table Scan</a></li>
    <li><a class="dropdown-item" href="../articles/VALID-VI.html">VALID-VI: R Markdown Document Validation</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Information Management</h6></li>
    <li><a class="dropdown-item" href="../articles/INFO-1.html">Intro to Information Management</a></li>
    <li><a class="dropdown-item" href="../articles/INFO-2.html">Advanced Information Management</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstudio/pointblank/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Introduction to the Expectations in Unit Tests Workflow (VALID-III)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rstudio/pointblank/blob/main/vignettes/VALID-III.Rmd" class="external-link"><code>vignettes/VALID-III.Rmd</code></a></small>
      <div class="d-none name"><code>VALID-III.Rmd</code></div>
    </div>

    
    
<p><img src="images%2FVALID-III.svg" width="100%"></p>
<p>The <em>VALID-III: Expectations in Unit Tests</em> workflow is all
about checking your data alongside your usual <strong>testthat</strong>
tests. The functions used for this workflow all begin with the
<code>expect_</code> prefix and are based on the set of validation
functions used in the <a href="../articles/VALID-I.html"><strong>VALID-I</strong></a> and <a href="../articles/VALID-II.html"><strong>VALID-II</strong></a>
workflows. Here’s the complete list of functions with a phrase for each
function’s expectation:</p>
<ul>
<li>
<code><a href="../reference/col_vals_lt.html">expect_col_vals_lt()</a></code>: Expect that column data are less
than a specified value.</li>
<li>
<code><a href="../reference/col_vals_lte.html">expect_col_vals_lte()</a></code>: Expect that column data are less
than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_equal.html">expect_col_vals_equal()</a></code>: Expect that column data are
equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_not_equal.html">expect_col_vals_not_equal()</a></code>: Expect that column data
are not equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gte.html">expect_col_vals_gte()</a></code>: Expect that column data are
greater than or equal to a specified value.</li>
<li>
<code><a href="../reference/col_vals_gt.html">expect_col_vals_gt()</a></code>: Expect that column data are
greater than a specified value.</li>
<li>
<code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code>: Expect that column data are
between two specified values.</li>
<li>
<code><a href="../reference/col_vals_not_between.html">expect_col_vals_not_between()</a></code>: Expect that column data
are not between two specified values.</li>
<li>
<code><a href="../reference/col_vals_in_set.html">expect_col_vals_in_set()</a></code>: Expect that column data are
part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_not_in_set.html">expect_col_vals_not_in_set()</a></code>: Expect that column data
are not part of a specified set of values.</li>
<li>
<code><a href="../reference/col_vals_make_set.html">expect_col_vals_make_set()</a></code>: Expect that a set of values
entirely accounted for in a column of values.</li>
<li>
<code><a href="../reference/col_vals_make_subset.html">expect_col_vals_make_subset()</a></code>: Expect that a set of
values a subset of a column of values.</li>
<li>
<code><a href="../reference/col_vals_increasing.html">expect_col_vals_increasing()</a></code>: Expect column data
increasing by row.</li>
<li>
<code><a href="../reference/col_vals_decreasing.html">expect_col_vals_decreasing()</a></code>: Expect column data
decreasing by row.</li>
<li>
<code><a href="../reference/col_vals_null.html">expect_col_vals_null()</a></code>: Expect that column data are
<code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_not_null.html">expect_col_vals_not_null()</a></code>: Expect that column data are
not <code>NULL</code>/<code>NA</code>.</li>
<li>
<code><a href="../reference/col_vals_regex.html">expect_col_vals_regex()</a></code>: Expect that strings in column
data match a regex pattern.</li>
<li>
<code><a href="../reference/col_vals_within_spec.html">expect_col_vals_within_spec()</a></code>: Expect that values in
column data fit within a specification.</li>
<li>
<code><a href="../reference/col_vals_expr.html">expect_col_vals_expr()</a></code>: Expect that column data agree
with a predicate expression.</li>
<li>
<code><a href="../reference/rows_distinct.html">expect_rows_distinct()</a></code>: Expect that row data are
distinct.</li>
<li>
<code><a href="../reference/rows_complete.html">expect_rows_complete()</a></code>: Expect that row data are
complete.</li>
<li>
<code><a href="../reference/col_is_character.html">expect_col_is_character()</a></code>: Expect that the columns
contain character/string data.</li>
<li>
<code><a href="../reference/col_is_numeric.html">expect_col_is_numeric()</a></code>: Expect that the columns
contain numeric values.</li>
<li>
<code><a href="../reference/col_is_integer.html">expect_col_is_integer()</a></code>: Expect that the columns
contain integer values.</li>
<li>
<code><a href="../reference/col_is_logical.html">expect_col_is_logical()</a></code>: Expect that the columns
contain logical values.</li>
<li>
<code><a href="../reference/col_is_date.html">expect_col_is_date()</a></code>: Expect that the columns contain R
<code>Date</code> objects.</li>
<li>
<code><a href="../reference/col_is_posix.html">expect_col_is_posix()</a></code>: Expect that the columns contain
<code>POSIXct</code> dates.</li>
<li>
<code><a href="../reference/col_is_factor.html">expect_col_is_factor()</a></code>: Expect that the columns contain
R <code>factor</code> objects.</li>
<li>
<code><a href="../reference/col_exists.html">expect_col_exists()</a></code>: Expect that one or more columns
actually exist.</li>
<li>
<code><a href="../reference/col_schema_match.html">expect_col_schema_match()</a></code>: Expect that columns in the
table (and their types) match a predefined schema.</li>
<li>
<code><a href="../reference/row_count_match.html">expect_row_count_match()</a></code>: Expect that the row count
matches that of a different table.</li>
<li>
<code><a href="../reference/col_count_match.html">expect_col_count_match()</a></code>: Expect that the column count
matches that of a different table.</li>
<li>
<code><a href="../reference/conjointly.html">expect_conjointly()</a></code>: Expect that multiple rowwise
validations result in joint validity.</li>
<li>
<code><a href="../reference/serially.html">expect_serially()</a></code>: Run several tests and a final
validation in a serial manner with a passing expectation.</li>
<li>
<code><a href="../reference/specially.html">expect_specially()</a></code>: Perform a specialized validation
with a user-defined function with a passing expectation.</li>
</ul>
<p>Now that we know that the functions are similar in intent but
different in name, let’s learn how to use these functions
effectively.</p>
<div class="section level2">
<h2 id="using-expect_-functions-in-the-testthat-way">Using <code>expect_*()</code> Functions in the
<strong>testthat</strong> Way<a class="anchor" aria-label="anchor" href="#using-expect_-functions-in-the-testthat-way"></a>
</h2>
<p>The <strong>testthat</strong> package has collection of functions
that begin with <code>expect_</code>. It’s no coincidence that the
<strong>pointblank</strong> for the <strong>VALID-III</strong> workflow
adopts the same naming convention. The idea is to use these functions
interchangeably with those from <strong>testthat</strong> in the
standard <strong>testthat</strong> workflow (in a
<code>test-&lt;name&gt;.R</code> file, inside the
<code>tests/testthat</code> folder). The big difference here is that
instead of testing function outputs, we are testing data tables.
However, tables may be returned from function calls and the
<code>expect_*()</code> functions offered up by
<strong>pointblank</strong> might offer more flexibility for testing
that data. For instance <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> allows us
to write an expectation with fine control on boundary values (and
whether they are inclusive bounds), whether <code>NA</code> values
should be ignored, and we can even set a failure threshold if that makes
sense for the expectation.</p>
<p>Here’s an example of how to generate some tests on data with
<strong>testthat</strong> and also with <strong>pointblank</strong>. For
the <code>small_table</code> dataset, let’s write expectations that show
that non-NA values in column <code>c</code> are between <code>2</code>
and <code>9</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html" class="external-link">expect_true</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">small_table</span><span class="op">$</span><span class="va">c</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>There is no <strong>testthat</strong> function that tests for values
between two values. The original strategy was to use
<code><a href="https://testthat.r-lib.org/reference/comparison-expectations.html" class="external-link">testthat::expect_gte()</a></code> and <code>testthat::lte()</code>
with <code>small_table$c</code> as the <code>object</code> in both,
however, that doesn’t work because that results in a logical vector
greater than length 1. Also, there is no allowance for <code>NA</code>
values to be skipped. The best I could do was the above.</p>
<p>The <strong>pointblank</strong> version of this task makes for a more
succinct and understandable expectation expression:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/col_vals_between.html">expect_col_vals_between</a></span><span class="op">(</span><span class="va">small_table</span>, <span class="va">c</span>, <span class="fl">2</span>, <span class="fl">9</span>, na_pass <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The arguments in the <code><a href="../reference/col_vals_between.html">expect_col_vals_between()</a></code> give us
everything we need to check tabular data without having to do subsetting
and perform other transformations. There are a few added benefits.
Should data come from a data source other than a local data frame, the
SQL expressions are handled internally and they have been tested
extensively across all the supported database types and in Spark
DataFrames as well.</p>
</div>
<div class="section level2">
<h2 id="these-expect_-functions-are-simpler-than-their-counterparts">These <code>expect_*()</code> Functions Are Simpler Than Their
Counterparts<a class="anchor" aria-label="anchor" href="#these-expect_-functions-are-simpler-than-their-counterparts"></a>
</h2>
<p>All of the <code>expect_*()</code> functions have the same leading
arguments of their validation function counterparts but they omit the
following arguments at the end of their signatures:</p>
<ul>
<li><code>actions</code></li>
<li><code>step_id</code></li>
<li><code>label</code></li>
<li><code>brief</code></li>
<li><code>active</code></li>
</ul>
<p>While we lose the <code>actions</code> argument, we get in its place
the <code>threshold</code> argument. This is a simple failure threshold
value for use with the expectation (<code>expect_*</code>) and the test
(<code>test_*</code>) functions. By default, <code>threshold</code> is
set to <code>1</code> which means that any single test unit failing will
result in an overall failure (i.e., the expectation will fail).</p>
<p>As with the thresholds set in the <code><a href="../reference/action_levels.html">action_levels()</a></code>
functions (or the shortcut functions <code><a href="../reference/action_levels.html">warn_on_fail()</a></code> and
<code><a href="../reference/action_levels.html">stop_on_fail()</a></code>), whole numbers beyond <code>1</code>
indicate that any failing units up to that absolute threshold value will
result in a succeeding expectation. Likewise, fractional values (between
<code>0</code> and <code>1</code>) act as a proportional failure
threshold, where <code>0.25</code> means that 25% of failing test units
results in a failed expectation.</p>
<p>The <code>preconditions</code> argument can be used to transform the
input data before evaluation of the expectation. This is useful is some
cases where you might need to summarize the input data table, mutate
columns, perform some filtering, or even perform table joins
beforehand.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Iannone, Mauricio Vargas, June Choe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
